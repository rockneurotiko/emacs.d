from . import base
import logging



class Cpu(base.InLoopPollText):
    """
        Displays Wifi ssid and quality.
    """
    defaults = [
      ('frequency', 1, 'The interface to monitor'),
    ]
    def __init__(self, **config):
      base.InLoopPollText.__init__(self, **config)
      self.add_defaults(Cpu.defaults)
      self.oldvalues = self._get_cpu()
      self.lastvalue = 0

    def _get_cpu(self):
        with open('/proc/stat') as f:
            line = f.readlines()[0]
        name, user, nice, sys, idle, iowait, tail = line.split(None, 6)
        return tuple(map(int, [user, nice, sys, idle]))


    def poll(self):
        nval = self._get_cpu()
        oval = self.oldvalues
        busy = nval[0] + nval[1] + nval[2] - (oval[0] + oval[1] + oval[2])
        total = busy + (nval[3] - nval[3])

        if total:
            self.lastvalue = str(busy * 100.0 / total)
            return self.lastvalue
        else:
            return self.lastvalue
        self.oldvalues = nval
